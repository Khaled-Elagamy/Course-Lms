@using Course_Lms.ViewModels
@model CourseSetupViewModel
@{
	ViewData["Title"] = "CourseSetup";
}
<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.css" integrity="sha512-8D+M+7Y6jVsEa7RD6Kv/Z7EImSpNpQllgaEIQAtqHcI0H6F4iZknRj0Nx1DCdB+TwBaS+702BGWYC0Ze2hpExQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<style>
	.p-1 {
		padding: 0.25rem; /* Adjust the value based on your design */
	}

	.bg-sky-100 {
		background-color: rgb(224 242 254); /* Replace with the actual color value */
	}

	p {
		width: 500px;
		background: #f5f5f5;
		border: 1px solid #ddd;
		padding: 5px;
	}

	.card {
		max-height: auto; /* Set a max height for the expanded card */
	}

	.custom-icon {
		color: rgb(3 105 161); /* Change this to the desired color */
	}

	.card-header {
		height: 100px;
	}

	.edit-button, .addChapterBtn, #editImageButton {
		text-decoration: none;
		font-size: 14px !important;
	}

	.field-validation-error {
		color: #dc3545;
	}
</style>
<div class="custom-alert warning" id="warningNotification">
	<i class="bi bi-exclamation-triangle"></i>
	This course is unpublished.It will not be visible to students.
</div>
<div style="padding:1.5rem;">
	<div style="display:flex;align-items:center;justify-content: space-between;">
		<div class="completionText" style=" display:flex;justify-content: space-between;align-items: center;width: 100%;">
		</div>
	</div>
</div>
<div class="container mt-3">
	<input class="id" type="hidden" asp-for="Id" />
	<div class="row">
		<div class="col-md-6 mb-3">
			<h4><i class="bi bi-columns-gap custom-icon rounded-circle p-1 bg-sky-100"></i> Customize your course </h4>
			<div class="card">
				<div class="card-header">
					<h5 class="card-title">Title</h5>
					<a href="#" class="btn btn-link edit-button float-end"><i class="bi bi-pencil"></i> Edit</a>
					<button type="submit" class="btn btn-success save-button" style="display:none;">Save</button>
				</div>
				<div class="card-body">
					<p class="card-text" onkeypress="return (this.innerText.length <= 50)" contenteditable="false">@Model.Title</p>
					<span asp-validation-for="Title" class="field-validation-error"></span>
					<span id="titleErrorMessage" class="text-danger"></span>
				</div>
			</div>
			<form id="descriptionForm">
				<div class="card">
					<div class="card-header">
						<h5 class="card-title">Description</h5>
						<a href="#" class="btn btn-link edit-button float-end"><i class="bi bi-pencil"></i> Edit</a>
						<button type="submit" class="btn btn-success save-button" style="display:none;">Save</button>
					</div>
					<div class="card-body">
						@* 						<input asp-for="Description" class="card-text" onkeypress="return (this.innerText.length <= 500)" contenteditable="false" />
						*@						<p asp-for="Description" class="card-text" onkeypress="return (this.innerText.length <= 500)" contenteditable="false">@Model.Description</p>
						<span asp-validation-for="Description" class="field-validation-error"></span>
					</div>
				</div>
			</form>

			<div class="card">
				<div class="card-header">
					<h5 class="card-title">Image</h5>
					<a href="#" class="btn btn-link  float-end" id="editImageButton">
						<i class="bi bi-pencil custom-icon rounded-circle p-1 bg-sky-100"></i> Add an image
					</a>
					<button type="submit" class="btn btn-success save-button" style="display:none;">Save</button>
				</div>
				<div class="card-body">
					<form id="uploadForm" enctype="multipart/form-data">
						<div class="form-group" style="margin-bottom: 10px;">
							<input asp-for="ImageFile" type="file" accept="image/*" class="imageInput form-control" />
							<span asp-validation-for="ImageFile" class="text-danger  class=" field-validation-error""></span>
						</div>
						<img id="courseImage" src="@Url.Content("/images/"+ Model.ImageUrl)" alt="Course image" width="400" height="400" onerror="handleImageError(this)" class="img-fluid mb-3" />
					</form>
				</div>
			</div>
			<div class="card">
				<div class="card-header">
					<h5 class="card-title">Course Category</h5>
					<a class="btn btn-link category-edit-button float-end"><i class="bi bi-pencil"></i> Edit</a>
					<button type="submit" class="btn btn-success category-save-button" style="display:none;">Save</button>
				</div>
				<div class="card-body">
					<select asp-for="CategoryId" asp-items="Model.Categories" class="form-select" disabled>
						<option selected disabled value="">-- Select Category --</option>
					</select>
					<span asp-validation-for="CategoryId" class="field-validation-error"></span>

				</div>
			</div>
		</div>

		<div class="col-md-6 mb-3">
			<h4><i class="bi bi-list-check custom-icon rounded-circle p-1 bg-sky-100"></i> Course chapters </h4>
			<div class="card">
				<div class="card-header">
					<h5 class="card-title">Chapters</h5>
					@if (!Model.Chapters.Any(ch => ch.IsPublished))
					{
						<span style="font-size:13px; color:grey;">Must has at least one published chapter</span>
					}
					<a class="btn btn-link addChapterBtn float-end"><i class="bi bi-plus-circle"></i> Add a chapter</a>
				</div>
				<div class="card-body">
					<div id="sortableChapters">
						@await Html.PartialAsync("_ChaptersPartial", Model.Chapters)
					</div>
					<form id="newChapterForm" asp-action="CreateChapter" asp-controller="Chapters" method="post" style="display:none;">
						<input type="hidden" id="courseId" name="courseId" value="@Model.Id" />
						<input type="text" id="newChapterTitle" class="form-control" placeholder="Introduction to course" />
						<button id="createChapterBtn" class="btn btn-primary mt-3" disabled>Create</button>
					</form>	
					@if (Model.Chapters.Any())
					{
					<span style="font-size:13px; color:grey;">Drag and Drop to Reorder</span>
					}
				</div>
			</div><br />
			<h4><i class="bi bi-coin custom-icon rounded-circle p-1 bg-sky-100"></i> Sell your course </h4>
			<div class="card">
				<div class="card-header">
					<h5 class="card-title">Price</h5>
					<a href="#" class="btn btn-link edit-button float-end"><i class="bi bi-pencil"></i> Edit</a>
					<button type="submit" class="btn btn-success save-button" style="display:none;">Save</button>
				</div>
				<div class="card-body">
					<input type="number" class="price-input form-control" asp-for="Price" disabled>
					<span asp-validation-for="Price" class="field-validation-error"></span>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	function handleImageError(img) {
		img.src = '/images/noimage.jpg';
		img.alt = 'Default Image';
	}
</script>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}
@section myDataTable {

	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
	<script type="module" src="~/js/CourseSetup.js"></script>

}